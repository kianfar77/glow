.. meta::
  :description: Learn how to use the Hail library contained in |DBR| for Health and Life Sciences to analyze large genomic datasets.

.. _hail-02:

========
Hail 0.2
========

`Hail`_ is a library built on |AS| for analyzing large genomic datasets. Hail 0.2 is integrated into :ref:`Databricks Runtime HLS <dbr-hls>`.

.. admonition:: Beta
  :class: preview

  Hail 0.2 integration requires |DBR| HLS, which is in Beta. Properties of the |Databricks| environment, such as which Python packages are available by default, may change. Pricing is also subject to change before general availability.

.. _`Hail`: https://hail.is/

Create a Hail cluster
========================

To create a cluster with Hail installed:

#. Set the following  :ref:`environment variable <environment-variables>`:

   .. code-block:: ini

      ENABLE_HAIL=true

   This environment variable causes the cluster to launch with Hail 0.2, its dependencies, and Python 3.6 installed.

Use Hail in a notebook
========================

For the most part, Hail 0.2 code in |Databricks| works identically to the Hail documentation. However, there are a few modifications that are necessary for the |Databricks| environment.

Initialization
--------------

When initializing Hail, pass in the pre-created ``SparkContext`` and mark the initialization
as idempotent. This setting enables multiple |Databricks| notebooks to use the same Hail context.

.. code-block:: py

  import hail as hl
  hl.init(sc, idempotent=True)

Plotting
--------

Hail uses the `Bokeh`_ library to create plots. The ``show`` function built into Bokeh does not work
in |Databricks|. To display a Bokeh plot generated by Hail, you can run a command like:

.. code-block:: py

  from bokeh.embed import components, file_html
  from bokeh.resources import CDN
  plot = hl.plot.histogram(mt.DP, range=(0,30), bins=30, title='DP Histogram', legend='DP')
  html = file_html(plot, CDN, "Chart")
  displayHTML(html)

See :ref:`bokeh` for more information.

.. _`Bokeh`: https://bokeh.pydata.org/en/latest/

Limitations
===========
- When Hail support is enabled, your cluster uses Python 3.6, so notebooks written against different versions of Python may not work.
- When Hail support is enabled, fewer Python libraries are installed by default. You can still use the :ref:`libraries` feature to install new libraries.

After you've set up a Hail cluster, try out the Hail overview notebook.

.. notebook:: ../_static/notebooks/tertiary/hail-overview.html
  :title: Hail overview notebook


.. include:: /shared/products.rst
